---
/**
 * Componente Navbar mejorado
 * Implementa navegaci√≥n, selector de idioma y toggle de modo oscuro
 */
import Button from '../ui/Button.astro';
import T from '../ui/T.astro';
import { getI18n } from '../../i18n/utils';

const { lang, t } = getI18n(Astro.url);
---

<nav class="fixed top-0 w-full z-50 bg-white dark:bg-gray-800 shadow-md print-hide">
  <div class="container mx-auto px-4 py-3">
    <div class="flex justify-between items-center">
      <!-- Logo/Name -->
      <a href="#about" class="text-xl font-bold text-gray-800 dark:text-white" data-i18n="nav.title">
        {t('nav.title')}
      </a>
      
      <!-- Navigation Links -->
      <div class="hidden md:flex space-x-6">
        <a href="#about" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.about">
          {t('nav.about')}
        </a>
      
        <a href="#experience" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.experience">
          {t('nav.experience')}
        </a>
        <a href="#skills" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.skills">
          {t('nav.skills')}
        </a>
        <a href="#education" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.education">
          {t('nav.education')}
        </a>
        <a href="#courses" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.courses">
          {t('nav.courses')}
        </a>
        <a href="#furtherInfo" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.furtherInfo">
          {t('nav.furtherInfo')}
        </a>
      </div>
      
      <!-- Language and Dark Mode Toggles -->
      <div class="flex items-center space-x-4">
        <!-- Language Switcher -->
        <div class="flex space-x-2">
          <button id="es-btn" class="language-btn w-8 h-8 rounded-md flex items-center justify-center text-sm font-medium" data-lang="es" data-active={lang === 'es' ? 'true' : 'false'}>
            ES
          </button>
          <button id="en-btn" class="language-btn w-8 h-8 rounded-md flex items-center justify-center text-sm font-medium" data-lang="en" data-active={lang === 'en' ? 'true' : 'false'}>
            EN
          </button>
          <button id="fr-btn" class="language-btn w-8 h-8 rounded-md flex items-center justify-center text-sm font-medium" data-lang="fr" data-active={lang === 'fr' ? 'true' : 'false'}>
            FR
          </button>
        </div>
        
        <!-- Modern Dark Mode Toggle - Slider style -->
        <div class="flex items-center ml-4">
          <button 
            id="theme-toggle-btn"
            type="button" 
            class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 hover:bg-gray-300 dark:hover:bg-gray-600 cursor-pointer z-10"
            onclick="window.toggleTheme()"
            aria-label="Toggle dark mode"
          >
            <span class="sr-only">Toggle dark mode</span>
            <span 
              class="pointer-events-none absolute mx-auto h-4 w-4 rounded-full bg-white shadow-lg transform transition-transform duration-300 ease-in-out translate-x-1 dark:translate-x-6"
            ></span>
          </button>
          <span class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
            <span class="dark:hidden">Light</span>
            <span class="hidden dark:inline">Dark</span>
          </span>
        </div>
        
        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="md:hidden p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile Menu (Hidden by default) -->
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-2">
      <div class="flex flex-col space-y-3">
        <a href="#about" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.about" onclick="document.getElementById('mobile-menu').classList.add('hidden')">
          {t('nav.about')}
        </a>
        <a href="#education" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.education" onclick="document.getElementById('mobile-menu').classList.add('hidden')">
          {t('nav.education')}
        </a>
        <a href="#experience" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.experience" onclick="document.getElementById('mobile-menu').classList.add('hidden')">
          {t('nav.experience')}
        </a>
        <a href="#skills" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.skills" onclick="document.getElementById('mobile-menu').classList.add('hidden')">
          {t('nav.skills')}
        </a>
        <a href="#courses" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.courses" onclick="document.getElementById('mobile-menu').classList.add('hidden')">
          {t('nav.courses')}
        </a>
        <a href="#furtherInfo" class="nav-link text-gray-800 dark:text-gray-200" data-i18n="nav.furtherInfo" onclick="document.getElementById('mobile-menu').classList.add('hidden')">
          {t('nav.furtherInfo')}
        </a>
      </div>
    </div>
  </div>
</nav>

<style>
  .nav-link {
    transition-property: color, background-color, border-color, fill, stroke;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }
  
  .nav-link:hover {
    color: var(--color-primary, #2563eb); /* hover:text-primary */
  }
  
  .dark .nav-link {
    color: #d1d5db; /* dark:text-gray-300 */
  }
  
  .dark .nav-link:hover {
    color: var(--color-primary-400, #60a5fa); /* dark:hover:text-primary-400 */
  }
</style>

<script is:inline>
  // Direct inline script for theme toggle
  document.addEventListener('DOMContentLoaded', function() {
    // Set active language button
    const currentLang = document.documentElement.lang || 'es';
    document.querySelectorAll('.language-btn').forEach(btn => {
      if (btn.dataset.lang === currentLang) {
        btn.dataset.active = 'true';
      } else {
        btn.dataset.active = 'false';
      }
    });
    
    // Add event listeners to language buttons
    document.querySelectorAll('.language-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.language-btn').forEach(b => {
          b.dataset.active = 'false';
        });
        this.dataset.active = 'true';
      });
    });
  });
</script>

<script>
  // Importar utilidades
  import { initI18n } from '../../utils/i18n.js';
  
  // Initialize translations
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM content loaded, initializing i18n');
    
    // Inicializar traducciones
    initI18n();
  });
</script>

<script>
  function toggleTheme() {
    document.documentElement.classList.toggle('dark');
    const isDark = document.documentElement.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    console.log('Theme toggled to:', isDark ? 'dark' : 'light');
  }
</script>
